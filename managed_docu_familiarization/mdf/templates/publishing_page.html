{% extends 'layout/_grid.html' %}
{% load static %}

{% block title %}- MDF base template for users{% endblock title %}

{% block css %}
    <style>
        .container {
            display: flex;
            gap: 20px;
        }
        .list-container {
            width: 300px;
        }
        .list {
            border: 1px solid #ccc;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
        }
    </style>
{% endblock css %}

{% block content %}


<div class="container mb-4">
  <h2 class="mb-4">Add a New Document</h2>
  <form method="post" action="{% url 'mdf:publishing_page' %}">
    {% csrf_token %}
    {{ form.media }}
    <div class="mb-3">
      <label for="document_div" class="form-label">Document Info:</label>
      <div id="document_div">
        {{ form.name.label_tag }} {{ form.name }}
        {{ form.url.label_tag }} {{ form.url }}
      </div>
    </div>

    <div class="mb-3">
      <div id="contact_user_div" class="form-group">
        {{ form.contact_users.label_tag }} {{ form.contact_users }}
      </div>
    </div>

    <!-- Hidden field for sending data -->
    <!--<input type="hidden" name="contact_users" isd="contactUsersInput">-->
    <div class="form-check category-choice mb-4 pb-4">
      <!-- Categories -->
      {{ form.category.label_tag }} {{ form.category }}
    </div>
    <div id="deadline-selection" class="form-group mb-4 pb-4" style="display: none;">
      {{ form.deadline.label_tag }} {{ form.deadline }}
    </div>
    <div id="group-selection" class="form-group mb-4 pb-4" style="display: none;">
      {{ form.groups.label_tag }} {{ form.groups }}
    </div>
    <div class="form-group">
      {{ form.message.label_tag }} {{ form.message }}
    </div>
    <div class="mb-4 pb-4">
      <button type="submit" class="btn btn-success mt-3">Add Document</button>
    </div>

  </form>
</div>

    <script src="{% static 'admin/js/core.js' %}"></script>
    <script src="{% static 'admin/js/SelectBox.js' %}"></script>
    <script src="{% static 'admin/js/SelectFilter2.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'admin/css/widgets.css' %}">
    <script type="text/javascript">
        // Initialize the FilteredSelectMultiple widget on page load
        //window.addEventListener('load', function()
        document.addEventListener('DOMContentLoaded', function(){
            const groupSelectElement = document.getElementById("id_groups");
            const contactUserSelectElement = document.getElementById("id_users");
            if (groupSelectElement) {
                SelectFilter.init("id_groups", "Groups", 0);
            }
            if (contactUserSelectElement) {
                SelectFilter.init("id_users", "Users", 0);
            }
        });

        // JavaScript to show/hide the group selection based on category choice
        document.addEventListener('DOMContentLoaded', function() {
            // Get radio buttons and the group-selection div
            const categoryChoices = document.querySelectorAll('.category-choice input');
            const groupSelection = document.getElementById('group-selection');
            const deadlineSelection = document.getElementById('deadline-selection');

            // Function to toggle the visibility of the group-selection div
            function toggleGroupSelection() {
                const selectedCategory = document.querySelector('.category-choice input:checked');
                if (selectedCategory && (selectedCategory.value === '2' || selectedCategory.value === '3')) {
                    groupSelection.style.display = 'block';
                    if (selectedCategory.value === '3') {
                        deadlineSelection.style.display = 'block';
                    } else {
                        deadlineSelection.style.display = 'none';
                    }
                } else {
                    groupSelection.style.display = 'none';
                    deadlineSelection.style.display = 'none';
                }
            }

            // Attach event listeners to each radio button
            categoryChoices.forEach(choice => choice.addEventListener('change', toggleGroupSelection));

            // Initialize visibility based on the current selection
            toggleGroupSelection();
        });
    </script>


{% endblock content %}
